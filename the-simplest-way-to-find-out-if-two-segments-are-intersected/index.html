<a id="rocket" href="#top" class="show"></a><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>数学美 之 判断线段相交的最简方法 | thoughts of hsfzxjy</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">数学美 之 判断线段相交的最简方法</h1><a id="logo" href="/">thoughts of hsfzxjy</a><p class="description"></p><iframe src="https://ghbtns.com/github-btn.html?user=hsfzxjy&amp;type=follow&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px" class="github-btn"></iframe></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/categories/编程/"><i class="icon-code"> 码海拾贝</i></a><a href="/categories/杂感/"><i class="icon-life"> 五味杂感</i></a><a href="/about/"><i class="icon-about"> 我</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">数学美 之 判断线段相交的最简方法</h1><div class="post-meta">2016-02-19 | <span class="categories">分类于<a href="/categories/编程/">编程</a></span></div><span data-thread-key="/the-simplest-way-to-find-out-if-two-segments-are-intersected/" class="ds-thread-count"></span><div class="post-content"><blockquote>
<p>解析几何的巅峰<br>是 向量<br>那无关过程的狂妄与简洁<br>映射着大自然无与伦比的美</p>
</blockquote>
<h2 id="引子">引子</h2><p>如何判断两条直线是否相交？</p>
<p>这很容易。平面直线，无非就是两种关系：相交 或 平行。因此，只需判断它们是否平行即可。而直线平行，等价于它们的斜率相等，只需分别计算出它们的斜率，即可做出判断。</p>
<p>但倘若我把“直线”换成“线段”呢——如何判断两条线段是否相交？</p>
<p>这就有些难度了。和 直线 不同，线段 是有固定长度的，即使它们所属的两条直线相交，这两条线段也不一定相交。</p>
<p>也许你会说：分情况讨论不就行了嘛：</p>
<ul>
<li>先计算两条线段的斜率，判断是否平行。若平行，则一定不相交。</li>
<li>若不平行，求出两条线段的直线方程，联立之，解出交点坐标。</li>
<li>运用定比分点公式，判断交点是否在两条线段上。</li>
</ul>
<p>的确，从理论上这是一个可行的办法，这也是人们手动计算时普遍采用的方法。</p>
<p>然而，这个方法并不怎么适用于计算机。原因如下：</p>
<ul>
<li>计算中出现了除法（斜率计算、定比分点），因此每次计算前都要判断除数是否为 0（或接近 0）。这很麻烦，严重干扰逻辑的表达。</li>
<li>浮点精度丢失带来的误差。人类计算时可以采用分数，但计算机不行。计算机在储存浮点数时会有精度丢失的现象。一旦算法的计算量大起来，误差会被急剧放大，影响结果准确性。</li>
<li>效率低下。浮点乘除会十分耗时，不适用于对实时性要求较高的生产环境（如 游戏）。</li>
</ul>
<p><img src="http://www.qqday.com/uploads/allimg/120627/09210Bb8-3.png" alt=""></p>
<p>那么，有更好的方法？</p>
<p>当然有。<br><a id="more"></a></p>
<h2 id="类型预定义">类型预定义</h2><p>本文的算法将用 python 描述，主要用到两个数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 点</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x, self.y = x, y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start_point, end_point)</span>:</span></span><br><span class="line">        self.start, self.end = start_point, end_point</span><br><span class="line">        self.x = end_point.x - start_point.x</span><br><span class="line">        self.y = end_point.y - start_point.y</span><br></pre></td></tr></table></figure>
<p>先在此处说明。</p>
<h2 id="问题分析">问题分析</h2><p>对于“判断两条直线是否相交”这个问题，我们之所以能迅速而准确地进行判断，是因为“相交”与“不相交”这两个状态有着明显的不同点，即 <strong>斜率是否相等</strong>。</p>
<p>那么现在，为了判断两条线段是否相交，我们也要找出“相交”与“不相交”这两个状态的不同点。</p>
<p>假设现在有两条线段 AB 和 CD，我们画出它们之间的三种关系：</p>
<ol>
<li><img src="https://segmentfault.com/img/bVsRnf" alt="不相交"></li>
<li><img src="https://segmentfault.com/img/bVsRmQ" alt="交点位于某条线段上"></li>
<li><img src="https://segmentfault.com/img/bVsRnh" alt="相交"></li>
</ol>
<p>其中，情况 1 为不相交，情况 2、3 为相交。</p>
<p>作出向量 AC、AD、BC、BD。</p>
<p>首先介绍一个概念： <strong>向量有序对的旋转方向</strong>。这个概念指：对于共起点有序向量二元组<code>(a, b)</code>，其旋转方向为 <strong>使 a 能够旋转一个小于 180 度的角并与 b 重合的方向</strong>，简记为 <code>direct(a, b)</code>。若 <code>a</code> 和 <code>b</code> 反向共线，则旋转方向取任意值。</p>
<p>举个例子：图一中，<code>direct(AC, AD)</code> 为顺时针方向。</p>
<p>接下来我们要分析四个值：<code>direct(AC, AD)</code>、<code>direct(BC, BD)</code>、<code>direct(CA, CB)</code>、<code>direct(DA, DB)</code>。</p>
<ol>
<li>对于图一，<code>direct(AC, AD)</code> 和 <code>direct(BC, BD)</code> 都为顺时针，<code>direct(CA, CB)</code> 为逆时针，<code>direct(DA, DB)</code> 为顺时针。</li>
<li>对于图二，<code>direct(AC, AD)</code> 为顺时针，<code>direct(BC, BD)</code> 为任意方向，<code>direct(CA, CB)</code> 为逆时针，<code>direct(DA, DB)</code> 为顺时针。</li>
<li>对于图三，<code>direct(AC, AD)</code>、<code>direct(DA, DB)</code> 为顺时针，<code>direct(BC, BD)</code>、<code>direct(CA, CB)</code> 为逆时针。</li>
</ol>
<p>不难发现，两条线段相交的充要条件是：<code>direct(AC, AD) != direct(BC, BD)</code> 且 <code>direct(CA, CB) != direct(DA, DB)</code>。这便是“相交”与“不相交”这两个状态的不同点。</p>
<p>然而你可能会觉得：旋转方向这么一个虚无飘渺的东西，怎么用程序去描述啊？</p>
<p>再来看一幅图：</p>
<p><img src="https://segmentfault.com/img/bVsRna" alt=""></p>
<p>再来定义有向角：</p>
<blockquote>
<p>有向角 <code>&lt;a, b&gt;</code> 为 向量<code>a</code> <strong>逆时针</strong> 旋转到与 向量<code>b</code> 重合所经过的角度。</p>
</blockquote>
<p>不难看出，对于向量<code>a</code>、<code>b</code>：</p>
<ul>
<li>若 <code>direct(a, b)</code> 为逆时针，则 <code>0 &lt;= &lt;a, b&gt; &lt;= 180</code>，从而 <code>sin&lt;a, b&gt; &gt;= 0</code>。</li>
<li>若 <code>direct(a, b)</code> 为顺时针，则 <code>180 &lt;= &lt;a, b&gt; &lt;= 360</code>，从而 <code>sin&lt;a, b&gt; &lt;= 0</code>。</li>
</ul>
<p>这样一来，我们可以将旋转方向的问题转化为 <strong>求有向角正弦值</strong> 的问题。而这个问题，是很容易的。</p>
<p>如上图，记</p>
<p>$$ OA = (x_1, y_1), OB = (x_2, y_2) $$<br>$$ |OA| = r_1, |OB| = r_2 $$</p>
<p>则</p>
<p>$$ sin(\lt OA, OB\gt) $$<br>$$ = sin \theta $$<br>$$ = sin (\beta - \alpha) $$<br>$$ = sin \beta cos \alpha - sin \alpha cos \beta $$<br>$$ = \frac{(sin \beta cos \alpha - sin \alpha cos \beta) * r_1 * r_2}{r_1 * r_2} $$<br>$$ = {(x_1 * y_2 - x_2 * y_1) \over (r_1 * r_2)} $$</p>
<p>而这里，我们要的只是 <code>sin(&lt;OA, OB&gt;)</code> 的符号，而 <code>r1</code> 和 <code>r2</code> 又都是恒正的，因此只需判断 <code>x1 * y2 - x2 * y1</code> 的符号即可。</p>
<p>这个方法的数学背景是 <strong>叉乘</strong>，可以前往 <a href="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F%E7%A7%AF" target="_blank" rel="external">Wikipedia</a> 了解更多。</p>
<h2 id="思路小结">思路小结</h2><ul>
<li>由点 A，B，C，D 计算出向量 AC，AD，BC，BD</li>
<li>计算 <code>sin(&lt;AC, AD&gt;) * sin(&lt;BC, BD&gt;)</code> 和 <code>sin(&lt;CA, CB&gt;) * sin(&lt;DA, DB&gt;)</code>，若皆为非正数，则相交；否则，不相交。</li>
</ul>
<h2 id="实现">实现</h2><p>终于到代码部分了，想必大家都已不耐烦了吧。</p>
<p>在向量的辅助下，代码显得异常简单。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ZERO = <span class="number">1e-9</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">negative</span><span class="params">(vector)</span>:</span></span><br><span class="line">    <span class="string">"""取反"""</span></span><br><span class="line">    <span class="keyword">return</span> Vector(vector.end_point, vector.start_point)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vector_product</span><span class="params">(vectorA, vectorB)</span>:</span></span><br><span class="line">    <span class="string">'''计算 x_1 * y_2 - x_2 * y_1'''</span></span><br><span class="line">    <span class="keyword">return</span> vectorA.x * vectorB.y - vectorB.x * vectorA.y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_intersected</span><span class="params">(A, B, C, D)</span>:</span></span><br><span class="line">    <span class="string">'''A, B, C, D 为 Point 类型'''</span></span><br><span class="line">    AC = Vector(A, C)</span><br><span class="line">    AD = Vector(A, D)</span><br><span class="line">    BC = Vector(B, C)</span><br><span class="line">    BD = Vector(B, D)</span><br><span class="line">    CA = negative(AC)</span><br><span class="line">    CB = negative(BC)</span><br><span class="line">    DA = negative(AD)</span><br><span class="line">    DB = negative(BD)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (vector_product(AC, AD) * vector_product(BC, BD) &lt;= ZERO) \</span><br><span class="line">        <span class="keyword">and</span> (vector_product(CA, CB) * vector_product(DA, DB) &lt;= ZERO)</span><br></pre></td></tr></table></figure>
<p>一气呵成，没有恼人的除法，没有情况讨论，只是纯粹的简单运算。</p>
</div><div class="tags"><a href="/tags/向量/">向量</a><a href="/tags/数学/">数学</a><a href="/tags/计算几何/">计算几何</a></div><div class="post-nav"><a href="/thinking-in-the-day-before-lunar-new-year-of-2016/" class="next">除夕杂感<i class="icon-next"></i></a></div><div data-thread-key="/the-simplest-way-to-find-out-if-two-segments-are-intersected/" data-title="数学美 之 判断线段相交的最简方法" data-url="http://hsfzxjy.github.io//the-simplest-way-to-find-out-if-two-segments-are-intersected/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="/the-simplest-way-to-find-out-if-two-segments-are-intersected/" data-title="数学美 之 判断线段相交的最简方法" data-url="http://hsfzxjy.github.io//the-simplest-way-to-find-out-if-two-segments-are-intersected/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://hsfzxjy.github.io"></form></div></div><div class="widget"><div class="widget-title">导航<ul><li><a href="/archives/"> <i class="icon-archives"> 归档</i></a></li><li><a href="/works/"> <i class="icon-works"> 个人作品</i></a></li><li><a href="/atom.xml"> <i class="icon-rss"> 订阅</i></a></li></ul></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学/">数学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂感/">杂感</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载文章/">转载文章</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随手记/">随手记</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/单元测试/" style="font-size: 15px;">单元测试</a> <a href="/tags/Delphi/" style="font-size: 15px;">Delphi</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/计算几何/" style="font-size: 15px;">计算几何</a> <a href="/tags/向量/" style="font-size: 15px;">向量</a> <a href="/tags/随想/" style="font-size: 15px;">随想</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/DIY/" style="font-size: 15px;">DIY</a> <a href="/tags/字符串模板/" style="font-size: 15px;">字符串模板</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/Meta-Classes/" style="font-size: 15px;">Meta Classes</a> <a href="/tags/黑魔法/" style="font-size: 15px;">黑魔法</a> <a href="/tags/元编程/" style="font-size: 15px;">元编程</a> <a href="/tags/杂感/" style="font-size: 15px;">杂感</a> <a href="/tags/诗/" style="font-size: 15px;">诗</a> <a href="/tags/作文/" style="font-size: 15px;">作文</a> <a href="/tags/家书/" style="font-size: 15px;">家书</a> <a href="/tags/成人礼/" style="font-size: 15px;">成人礼</a> <a href="/tags/产品/" style="font-size: 15px;">产品</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/web设计/" style="font-size: 15px;">web设计</a> <a href="/tags/wisecity/" style="font-size: 15px;">wisecity</a> <a href="/tags/前端自动化测试，总结/" style="font-size: 15px;">前端自动化测试，总结</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/不经意间的感动/" style="font-size: 15px;">不经意间的感动</a> <a href="/tags/HFMUN重构系列/" style="font-size: 15px;">HFMUN重构系列</a> <a href="/tags/化学/" style="font-size: 15px;">化学</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/apt-get/" style="font-size: 15px;">apt-get</a> <a href="/tags/物理/" style="font-size: 15px;">物理</a> <a href="/tags/创新作文大赛/" style="font-size: 15px;">创新作文大赛</a> <a href="/tags/Sublime/" style="font-size: 15px;">Sublime</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/字体/" style="font-size: 15px;">字体</a> <a href="/tags/百题大过关/" style="font-size: 15px;">百题大过关</a> <a href="/tags/逆袭/" style="font-size: 15px;">逆袭</a> <a href="/tags/MySql/" style="font-size: 15px;">MySql</a> <a href="/tags/NOIP2014/" style="font-size: 15px;">NOIP2014</a> <a href="/tags/信息学竞赛/" style="font-size: 15px;">信息学竞赛</a> <a href="/tags/北大金秋营/" style="font-size: 15px;">北大金秋营</a> <a href="/tags/树状数组/" style="font-size: 15px;">树状数组</a> <a href="/tags/LCA/" style="font-size: 15px;">LCA</a> <a href="/tags/归并排序/" style="font-size: 15px;">归并排序</a> <a href="/tags/逆序对/" style="font-size: 15px;">逆序对</a> <a href="/tags/最小生成树/" style="font-size: 15px;">最小生成树</a> <a href="/tags/数论/" style="font-size: 15px;">数论</a> <a href="/tags/数列/" style="font-size: 15px;">数列</a> <a href="/tags/高精度/" style="font-size: 15px;">高精度</a> <a href="/tags/UVa/" style="font-size: 15px;">UVa</a> <a href="/tags/Pascal/" style="font-size: 15px;">Pascal</a> <a href="/tags/搜索/" style="font-size: 15px;">搜索</a> <a href="/tags/剪枝/" style="font-size: 15px;">剪枝</a> <a href="/tags/浮点数/" style="font-size: 15px;">浮点数</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/游记/" style="font-size: 15px;">游记</a> <a href="/tags/win32/" style="font-size: 15px;">win32</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/the-simplest-way-to-find-out-if-two-segments-are-intersected/">数学美 之 判断线段相交的最简方法</a></li><li class="post-list-item"><a class="post-list-link" href="/thinking-in-the-day-before-lunar-new-year-of-2016/">除夕杂感</a></li><li class="post-list-item"><a class="post-list-link" href="/a-simple-javascript-template-language/">17 行代码实现的简易 Javascript 字符串模板</a></li><li class="post-list-item"><a class="post-list-link" href="/meta-class-in-python/">Python “黑魔法” 之 Meta Classes</a></li><li class="post-list-item"><a class="post-list-link" href="/poems/">诗集</a></li><li class="post-list-item"><a class="post-list-link" href="/life-needs-discovery/">生活，需要被“发现”</a></li><li class="post-list-item"><a class="post-list-link" href="/letter-to-parents/">家书·十八岁成人礼</a></li><li class="post-list-item"><a class="post-list-link" href="/hobby-or-needs/">炫技？还是需求？</a></li><li class="post-list-item"><a class="post-list-link" href="/the-state-of-responsive-images-in-2015/">【译】响应式图片的现状</a></li><li class="post-list-item"><a class="post-list-link" href="/why-are-so-many-programming-languages/">【译】“为什么有这么多的编程语言？”</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">thoughts of hsfzxjy.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></body><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script>
<script src="/js/adjust-wechat.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>$(document).ready(function() {
    $('img').each(function() {
        if ($(this).parent().hasClass('fancybox')) return;
        if ($(this).hasClass('nofancybox')) return;
        var alt = this.alt;
        if (alt) $(this).after('<span class="caption">' + alt + '</span>');
        $(this).wrap('<a href="' + ($(this).attr('data-src') == null ? this.src : $(this).attr('data-src')) + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
        $(this).attr('rel', 'article');
    });
});</script><script>$(document).ready(function() {
    $("a[href$='.jpg'],a[href$='.png'],a[href$='.gif']").attr('rel', 'gallery').fancybox({
     helpers : {
     title: { type: 'inside'}
     }
 });
});
</script><script>var duoshuoQuery = {short_name:'hsfzxjy'};
(function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$']]},
    jax: ["input/TeX","output/HTML-CSS"]
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></html>