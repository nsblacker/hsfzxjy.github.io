<a id="rocket" href="#top" class="show"></a><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>thoughts of hsfzxjy | 不忌讳空山无人，不害怕遥望星辰</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">thoughts of hsfzxjy</h1><a id="logo" href="/">thoughts of hsfzxjy</a><p class="description">不忌讳空山无人，不害怕遥望星辰</p><iframe src="https://ghbtns.com/github-btn.html?user=hsfzxjy&amp;type=follow&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px" class="github-btn"></iframe></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/categories/编程/"><i class="icon-code"> 码海拾贝</i></a><a href="/categories/杂感/"><i class="icon-life"> 五味杂感</i></a><a href="/about/"><i class="icon-about"> 我</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h2 class="post-title"><a href="/hfmun-reconstruction-4/">【HFMUN重构系列】4. Restful API 框架</a></h2><div class="post-meta">2015-04-23</div><span data-thread-key="/hfmun-reconstruction-4/" class="ds-thread-count"></span><div class="post-content"><h2 id="0x01_什么是REST"><strong>0x01 什么是REST</strong></h2><p>“REST”这个词，也许会在许多场合上出现，但并不是每个人都理解它的意思。在维基百科中，它被定义为：</p>
<blockquote>
<p><strong>Representational State Transfer (REST)</strong> is a software architecture style consisting of guidelines and best practices for creating scalable web services. REST is a coordinated set of constraints applied to the design of components in a distributed hypermedia system that can lead to a more performant and maintainable architecture.    <cite>—— From <a href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="external">Wikipedia</a></cite></p>
</blockquote>
<p>也就是说：<strong>REST，它不是一种技术，也不是一种标准，而是一种网络资源访问模式，一种编程哲学</strong>。狭义上来说，REST指的是这样的设计思想：</p>
<ol>
<li>每一个 URI 代表一种资源</li>
<li>客户端和服务器之间，传递这种资源的某种表现层</li>
<li>客户端通过五个 HTTP 动词（GET，POST，PUT，PATCH，DELETE），对服务器端资源进行操作，实现”表现层状态转化”（State Transfer）</li>
</ol>
<p>狭义的 REST 范式是基于 B/S 架构，并使用 HTTP 协议进行数据交互。比起古老而笨重的 SOAP 等架构，这种模式更加轻便、直观，使网络资源的访问变得简洁、优雅，也更加符合当今 Web 开发的需求。</p>
<h2 id="0x02_如何正确使用_REST"><strong>0x02 如何正确使用 REST</strong></h2><p>正如上面所说，REST 是基于 HTTP 协议的。它用 URI 来定义资源，并用 HTTP 请求来操作资源。然而，并不是说使用了 HTTP 协议即可称之为 REST——真正意义上的 REST，有自己的一套准则。也正是这套准则，才使得 REST 简洁、优雅。</p>
<h3 id="REST_是语义的">REST 是语义的</h3><p>语义的（Semantic）是指：<strong>资源的 URI 或是资源的访问必须是有意义的，符合或尽量符合自然语言的规范</strong>。</p>
<p>举个例子：如果我要访问订单的列表，那么一个良好的 URI 定义应该是这样的：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/orders/</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<p>资源的 URI 通常由名词组成，这也正符合自然语言的规范——表达一个物体，人们使用名词。</p>
<p>如果要精确定位某一个资源，通常需要进一步限制资源：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/orders/1/</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<p>或是：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/orders/current/</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<p>甚至，可以表示资源的从属关系：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/users/current/orders/1/</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<p>这就像在和服务器对话一样：<strong>“请给我当前用户的第一份订单”</strong>。</p>
<p>而一些与资源本身无关的信息，比如列表的最大数目，可以放到 URI Params 中：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/orders/?limit=20</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<p>HTTP协议中的动词（Verbs），通常用来描述对资源的操作。每一种动词都有它自己的意义：</p>
<ul>
<li><strong>GET</strong>——获取资源</li>
<li><strong>POST</strong>——建立一个新的资源</li>
<li><strong>PUT</strong>——修改一个资源，必须提交该资源的所有内容</li>
<li><strong>PATCH</strong>——修改一个资源，可以只提交该资源的一部分内容</li>
<li><strong>DELETE</strong>——删除一个资源</li>
</ul>
<h3 id="REST_是多样的">REST 是多样的</h3><p>至于返回的数据，服务器端可以提供多种格式供客户端选择，如 JSON、XML、YAML等等，通常用格式的缩写作为尾缀：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">GET <span class="string">/orders.json/</span> HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<h3 id="REST_是健壮的">REST 是健壮的</h3><p>倘若用户请求的资源不存在或是提交的数据不合规范，服务器必须以<strong>HTTP状态码</strong>的方式通知客户端。常用的状态码有：</p>
<ul>
<li><strong>400</strong> 请求参数有误</li>
<li><strong>401</strong> 用户未登录</li>
<li><strong>403</strong> 没有权限</li>
<li><strong>404</strong> 资源找不到</li>
</ul>
<h2 id="0x03_django_中的_REST"><strong>0x03 django 中的 REST</strong></h2><p>像 REST 这么高大上的东西，早就有人对它进行了实现，这便是：<a href="http://www.django-rest-framework.org/" target="_blank" rel="external">Django Rest Framework</a>。基本的用法可以参见官网。</p>
<p>成熟的框架并不是最好的，只有适合自己的才是。在使用过程中我遇到了一系列的问题，并以自己的方式解决了他们。</p>
<h3 id="ViewSet_的路由不够_D-R-Y-">ViewSet 的路由不够 D.R.Y.</h3><p><code>ViewSet</code> 是 <code>rest_framework</code>中一个十分有创意的地方。它将 CRUD 操作集中到了一个类中，提高了代码的复用性。然而，每一个 <code>ViewSet</code> 都需要 定义一个 <code>Router</code> 进行 URL 路由，这很麻烦。于是乎我便想：</p>
<blockquote>
<p>要是能让它自动感知<code>ViewSet</code>的存在并自动为其定义路由，就像<code>django</code>中的<code>Models</code>一样，那该多好啊</p>
</blockquote>
<p>于是，我仿照<code>django.apps.registry</code>，写了一个能在启东时探知一个 app 中固定内容的 <code>app_cache</code> 模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app_cache/core.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.utils.importlib <span class="keyword">import</span> import_module</span><br><span class="line"><span class="keyword">from</span> django.utils.module_loading <span class="keyword">import</span> module_has_submodule</span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> apps</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppCache</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''</span><br><span class="line">    Inherit this class and override the fields below, then import and instantiate</span><br><span class="line">    the subclass at AppConfig.ready method.</span><br><span class="line">    '''</span></span><br><span class="line"></span><br><span class="line">    module_name = <span class="string">''</span></span><br><span class="line">    object_name = <span class="string">''</span></span><br><span class="line">    default_object = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        self.__module_name = <span class="string">'.%s'</span> % self.module_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_objects</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> mod <span class="keyword">in</span> self.get_modules():</span><br><span class="line">            <span class="keyword">yield</span> getattr(mod, self.object_name, self.default_object)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_modules</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> app_config <span class="keyword">in</span> apps.get_app_configs():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> module_has_submodule(app_config.module, self.module_name):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> import_module(self.__module_name, app_config.name)</span><br></pre></td></tr></table></figure>
<p>同时新建一个叫<code>api</code>的 app，在<code>api/core.py</code>中实现自动寻找<code>ViewSet</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app_cache <span class="keyword">import</span> AppCache</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APICache</span><span class="params">(AppCache)</span>:</span></span><br><span class="line"></span><br><span class="line">    default_object = ()</span><br><span class="line">    object_name = <span class="string">'routers'</span></span><br><span class="line">    module_name = <span class="string">'routers'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_routers</span><span class="params">(self)</span>:</span></span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> self.get_objects():</span><br><span class="line">            results.extend(obj)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">cache = APICache()</span><br></pre></td></tr></table></figure>
<p>在<code>api/urls.py</code>中实现自动路由：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api/urls.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, patterns, include</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ViewSetMixin</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .core <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line">extra_list = []</span><br><span class="line">router = DefaultRouter()</span><br><span class="line"><span class="keyword">for</span> pattern, obj <span class="keyword">in</span> cache.get_routers():</span><br><span class="line">    <span class="keyword">if</span> callable(obj) <span class="keyword">and</span> <span class="keyword">not</span> isinstance(obj, type) <span class="keyword">or</span> isinstance(obj, basestring):</span><br><span class="line">        extra_list.append(url(pattern, obj))</span><br><span class="line">    <span class="keyword">elif</span> issubclass(obj, ViewSetMixin):</span><br><span class="line">        router.register(pattern, obj)</span><br><span class="line">    <span class="keyword">elif</span> issubclass(obj, APIView):</span><br><span class="line">        extra_list.append(url(pattern, obj.as_view()))</span><br><span class="line"></span><br><span class="line">extra_list.append(url(<span class="string">r'^'</span>, include(router.urls)))</span><br><span class="line"></span><br><span class="line">urlpatterns = patterns(<span class="string">''</span>,</span><br><span class="line">    url(<span class="string">r'^auth/'</span>, include(<span class="string">'rest_framework.urls'</span>, namespace = <span class="string">'rest_framework'</span>)),</span><br><span class="line">    url(<span class="string">r'^root/$'</span>, <span class="string">'api.views.root'</span>,),</span><br><span class="line">    *extra_list</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>之后，只需在每个 app 中定义一个<code>routers.py</code>，并定义<code>routers</code>变量即可实现 <code>ViewSet</code> 的自动路由，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> UserAPIViewSet</span><br><span class="line"></span><br><span class="line">routers = (</span><br><span class="line">    (<span class="string">r'users'</span>, UserAPIViewSet),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>非常方便。</p>
<h3 id="分页机制的进一步改进">分页机制的进一步改进</h3><p><code>rest_framework</code>提供了一个数据分页的机制：透过<code>limit</code>和<code>page</code>这两个 URL 参数可以实现数据的分页以及页码索引。</p>
<p>但这个功能在客户要求的应用场景中似乎并不太实用。毕竟，模联大会是一次节奏紧张的活动，网站并发量大，内容更新频繁，若应用传统分页的构想，可能会出现翻页时浏览到重复内容的情况。除此之外，这样的架构不利于实现<strong>瀑布流式</strong>的界面，因为瀑布流式要求待加载的数据与已加载的数据完美地无缝接合，而这一点对于传统分页架构来说也是力不从心。</p>
<p>曾记得，<a href="http://open.weibo.com/wiki/2/statuses/public_timeline" target="_blank" rel="external">新浪微博 API </a>中好像有类似的实现：凡是返回一个列表的 API ，返回数据中都会有<code>previous_cursor</code>和<code>next_cursor</code>两个参数，通过这两个参数，开发者可以获取上一份或下一份的数据。受此启发，我决定增强一下<code>rest_framework</code>的分页机制。</p>
<blockquote>
<p>####想法</p>
<ol>
<li>可在 API 的请求中传入参数 <code>sinceid</code> 或是 <code>beforeid</code>，表示获取<code>id</code>紧跟着<code>&lt;sinceid&gt;</code>或是<code>&lt;beforeid&gt;</code>的一批数据。</li>
<li>当 API 返回值是一个列表时，返回数据中增加两个域<code>since</code>和<code>before</code>，分别是指向上一批数据及下一批数据的 URL。</li>
</ol>
</blockquote>
<p>改动得不多，于是我便直接在别人的代码里开刀了。</p>
<p>首先在<code>rest_framework/</code>中增加一个<code>custom_filters.py</code>，用于存放自定义的过滤器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django_filters <span class="keyword">import</span> FilterSet, NumberFilter</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'get_timeline_filter'</span>, <span class="string">'is_timeline_filter'</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimelineFilter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_timeline_filter</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> issubclass(obj.__class__, TimelineFilter)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_timeline_filter</span><span class="params">(model_class, base_filter_class = FilterSet)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    工厂方法，给不同的模型类指派不同的过滤器</span><br><span class="line">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> base_filter_class:</span><br><span class="line">        base_filter_class = FilterSet</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">_TimelineFilter</span><span class="params">(base_filter_class, TimelineFilter)</span>:</span></span><br><span class="line"></span><br><span class="line">        sinceid = NumberFilter(name = <span class="string">'pk'</span>, lookup_type = <span class="string">'gt'</span>)</span><br><span class="line">        beforeid = NumberFilter(name = <span class="string">'pk'</span>, lookup_type = <span class="string">'lt'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(getattr<span class="params">(base_filter_class,<span class="string">'Meta'</span>,object)</span>)</span>:</span></span><br><span class="line">            model = model_class</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _TimelineFilter</span><br></pre></td></tr></table></figure>
<p>修改<code>rest_framework/generics.py</code>，为<code>GenericAPIView</code>加入<code>hack_filter_class()</code>方法，放入上面定义的过滤器；再修改<code>get_filter_backends()</code>方法，使其生效：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .custom_filters <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericAPIView</span><span class="params">(views.APIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hack_filter_class</span><span class="params">(self)</span>:</span></span><br><span class="line">        filter_class = getattr(self, <span class="string">'filter_class'</span>, <span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_timeline_filter(filter_class):</span><br><span class="line">            self.filter_class = get_timeline_filter(self.model, filter_class)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_filter_backends</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span><br><span class="line">        Returns the list of filter backends that this view requires.</span><br><span class="line">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.is_timeline:</span><br><span class="line">            self.hack_filter_class()</span><br><span class="line"></span><br><span class="line">        filter_backends = self.filter_backends <span class="keyword">or</span> []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> filter_backends <span class="keyword">and</span> self.filter_backend:</span><br><span class="line">            warnings.warn(</span><br><span class="line">                <span class="string">'The `filter_backend` attribute and `FILTER_BACKEND` setting '</span></span><br><span class="line">                <span class="string">'are due to be deprecated in favor of a `filter_backends` '</span></span><br><span class="line">                <span class="string">'attribute and `DEFAULT_FILTER_BACKENDS` setting, that take '</span></span><br><span class="line">                <span class="string">'a *list* of filter backend classes.'</span>,</span><br><span class="line">                PendingDeprecationWarning, stacklevel=<span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">            filter_backends = [self.filter_backend]</span><br><span class="line">        <span class="keyword">return</span> filter_backends</span><br></pre></td></tr></table></figure>
<p>最后再修改<code>rest_framework/pagination.py</code>，这个模块的功能是给<code>Serializer</code>加入分页机制中一些必要的域，如<code>next</code>和<code>previous</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">sinceid_field = <span class="string">'sinceid'</span></span><br><span class="line">beforeid_field = <span class="string">'beforeid'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SinceIdField</span><span class="params">(serializers.Field)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_native</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value.object_list = value.object_list[:]</span><br><span class="line">            sinceid = max(obj.id <span class="keyword">for</span> obj <span class="keyword">in</span> value.object_list) </span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        request = self.context.get(<span class="string">'request'</span>)</span><br><span class="line">        url = request <span class="keyword">and</span> request.build_absolute_uri() <span class="keyword">or</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> replace_query_params(url, **&#123;</span><br><span class="line">            sinceid_field: sinceid,</span><br><span class="line">            beforeid_field: <span class="string">''</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeforeIdField</span><span class="params">(serializers.Field)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_native</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value.object_list = value.object_list[:]</span><br><span class="line">            beforeid = min(obj.id <span class="keyword">for</span> obj <span class="keyword">in</span> value.object_list) </span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        request = self.context.get(<span class="string">'request'</span>)</span><br><span class="line">        url = request <span class="keyword">and</span> request.build_absolute_uri() <span class="keyword">or</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> replace_query_params(url, **&#123;</span><br><span class="line">            beforeid_field: beforeid,</span><br><span class="line">            sinceid_field: <span class="string">''</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaginationSerializer</span><span class="params">(BasePaginationSerializer)</span>:</span></span><br><span class="line"></span><br><span class="line">    count = serializers.Field(source=<span class="string">'paginator.count'</span>)</span><br><span class="line">    next = NextPageField(source=<span class="string">'*'</span>)</span><br><span class="line">    previous = PreviousPageField(source=<span class="string">'*'</span>)</span><br><span class="line">    before = BeforeIdField(source=<span class="string">'*'</span>)</span><br><span class="line">    since = SinceIdField(source=<span class="string">'*'</span>)</span><br></pre></td></tr></table></figure>
<p>完成了——在没有修改一处业务逻辑代码的前提下，我增强了分页机制。</p>
<h2 id="0x04_前端接口"><strong>0x04 前端接口</strong></h2><p>终于来到前端部分了。</p>
</div></div><div class="post"><h2 class="post-title"><a href="/chemistry-impurity/">高中化学常用除杂方法</a></h2><div class="post-meta">2015-04-22</div><span data-thread-key="/chemistry-impurity/" class="ds-thread-count"></span><div class="post-content"><h2 id="0x00_规律">0x00 规律</h2><ol>
<li>要除去弱酸性气体中混有的强酸性气体杂质，我们常选用弱酸性气体溶于水后形成的饱和盐溶液。若弱酸性气体溶于水后为一元酸，则用该酸形成的饱和正盐溶液。若为二元弱酸，则为该酸形成的饱和酸式盐，如$Cl_2$混有$HCl$气体，用饱和食盐水净化吸收，如$CO_2$中混有$HCl$、$SO_2$用饱和$NaHCO_3$溶液净化吸收。 </li>
<li>要除去非还原性气体中的还原性气体，应选用反应前后均具固体的具有氧化性的物质。如$CO_2$中混有的$CO$,用灼热的$CuO$除去。 </li>
<li>要除去非氧化性气体中的氧化性气体，应选用反应前后均是固体的具有还原性的物质。如$CO_2$中混有的$O_2$，用灼热的铜网除去。 </li>
<li>要除去中性气体中的酸性气体，用强碱溶液或碱石灰吸收。如：$CO$中的混有的$CO_2$用$NaOH$溶液吸收除去。 </li>
<li>要除去中性气体中的碱性气体(一般是$NH_3$),用浓硫酸吸收。如：N2中混有的$NH_3$，用浓硫酸吸收除去。 </li>
<li>要除去饱和烃中的烯烃、炔烃气体，用溴水吸收，如：$CH_4$中混有$C_2H_4$、$C_2H_2$，用溴水可吸收除去。 </li>
<li>要除去有机烃中混有的无机酸性气体可用$NaOH$溶液和碱石灰吸收而除去。 </li>
<li>还有些个别方法，就应该个别记住了。如NO中混有的少量$NO_2$气体，可用水吸收转化而除去，$C_2H_4$中混有的$H_2S$,除可用规律4的方法除去外，还可用$CuSO_4$或$Pb(NO_3)_2$等溶液除去。</li>
</ol>
<h2 id="0x01_常见除杂">0x01 常见除杂</h2><ol>
<li>N2($O_2$) ——灼热的铜丝 2Cu+$O_2$=2 $CuO$  </li>
<li>$CO_2$($H_2S$) ——用饱和$NaHCO_3$溶液 $NaHCO_3$+$H_2S$=NaHS+$H_2O$+$CO_2$↑  </li>
<li>$CO_2$($CO$) ——灼热的氧化铜 $CuO$+$CO$=Cu+$CO_2$  </li>
<li>$CO_2$($HCl$) ——用饱和$NaHCO_3$溶液 $NaHCO_3$+$HCl$=$NaCl$+$H_2O$+$CO_2$↑  </li>
<li>$H_2S$($HCl$) —— 用饱和NaHS溶液 NaHS+$HCl$=$NaCl$+$H_2S$  </li>
<li>$SO_2$($HCl$) ——用饱和NaHSO3溶液 NaHSO3+$HCl$=$NaCl$+$H_2O$+$SO_2$↑  </li>
<li>$Cl_2$($HCl$) ——用饱和食盐水，$HCl$易溶而$Cl_2$不溶     </li>
<li><p>$MnO_2$(碳粉)——</p>
<ol>
<li>将混合物在氧气中点燃 C+$O_2$=$CO_2$ 或者</li>
<li>通入灼热的氧化钙 C+$CaO$=Ca+$CO_2$↑(条件:高温) 或者</li>
<li>通入灼热的氧化铁 3C+2 $Fe_2O_3$=3CO2↑+ 4Fe  </li>
</ol>
</li>
<li><p>碳粉($MnO_2$)——加浓盐酸$MnO_2$+4$HCl$(浓)=$MnCl_2$+$Cl_2$↑+2$H_2O$  </p>
</li>
<li>C($CuO$)——加稀盐酸$CuO$+2$HCl$=$CuCl_2$+$H_2O$  </li>
<li><p>$Al_2O_3$($Fe_2O_3$) ——这个一步是无法除去的啊！  </p>
<ol>
<li><p><strong>方法一</strong>： </p>
<ol>
<li>将固体混合物溶于过量的氢氧化钠溶液，过滤除去氧化铁，留下滤液。 $Al_2O_3$+2$OH^{-}$=2$AlO^{2-}$+$H_2O$ </li>
<li>向滤液中通入过量的$CO_2$，过滤得到$Al(OH)_3$,加热使$Al(OH)_3$分解。 $AlO^{2-}$+2$H_2O$+$CO_2$=$Al(OH)_3$+$HCO_3^-$ 2$Al(OH)_3$=$Al_2O_3$+3$H_2O$   </li>
</ol>
</li>
<li><p><strong>方法二</strong>：     </p>
<ol>
<li><p>将固体混合物溶于过量的盐酸溶液中，是混合物完全溶解。 $Al_2O_3$+6$H^+$=2$Al^{3+}$+3$H_2O$ $Fe_2O_3$+6$H^+$=2$Fe^{3+}$+3$H_2O$     </p>
</li>
<li><p>加入过量$NaOH$溶液,过滤除去沉淀$Fe(OH)_3$, $Fe^{3+}$+3$OH^{-}$=$Fe(OH)_3$ $Al^{3+}$+4$OH^{-}$=$AlO^{2-}$+2$H_2O$  </p>
</li>
<li><p>向滤液中通入过量的$CO_2$，过滤得到$Al(OH)_3$,加热使$Al(OH)_3$分解。$AlO^{2-}$+2$H_2O$+$CO_2$=$Al(OH)_3$+$HCO_3^-$ 2$Al(OH)_3$=$Al_2O_3$+3$H_2O$如果是反一下就直接加氢氧化钠啊！  </p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ol>
<li>SIO2($Al_2O_3$) ——加入稀盐酸$Al_2O_3$ + 6$HCl$ = 2AlCl3 + 3$H_2O$  </li>
<li>$FeCl_3$($FeCl_2$) ——通入氯气$Cl_2$+2 $FeCl_2$=2 $FeCl_3$   </li>
<li>$FeCl_2$($FeCl_3$) ——加入铁Cu+2 $FeCl_3$=$CuCl_2$+$FeCl_2$  </li>
<li>$NaCl$($NH_4Cl$) ——固体的话直接加热$NH_4Cl$=$NH_3$+$HCl$  </li>
<li>C2H6($C_2H_4$) ——通入溴水或者酸性高锰酸钾溶液$CH_2=CH_2$+$Br_2$→$CH_2Br-CH_2Br$  </li>
<li>溴苯($Br_2$) ——加入氢氧化钠2 $NaOH$+$Br_2$=$NaBr$+$NaBrO$+$H_2O$分液  </li>
<li>硝基苯($NO_2$) ——加入氢氧化钠2 $NO_2$ + 2 $NaOH$ = $NaNO_2$ + $NaNO_3$ +$H_2O$分液  </li>
<li>甲苯(苯酚)——加入氢氧化钠$Ph-OH$+$NaOH$=$Ph-ONa$+$H_2O$分液  </li>
<li>乙醛(乙酸)——加饱和碳酸钠2$CH_3COOH$ + $Na_2CO_3$ = 2$CH_3COONa$+ $H_2O$ + $CO_2$蒸馏</li>
<li>乙醇(水)——加氧化钙蒸馏  </li>
<li>乙酸乙酯(乙酸)——饱和碳酸钠溶液2$CH_3COOH$ + $Na_2CO_3$ = 2$CH_3COONa$+ $H_2O$ + $CO_2$分液  </li>
<li>肥皂(甘油)——加入$NaCl$，发生盐析进行过滤  </li>
<li>葡萄糖(淀粉)——加入稀硫酸水解$C_6H_{10}O_5$(淀粉)+$H_2O$=$C_6H_{12}O_6$(葡萄糖)  </li>
<li>溴乙烷(乙醇)——用水，分液 </li>
</ol>
</div></div><div class="post"><h2 class="post-title"><a href="/backup-apt-get/">如何备份apt-get已安装的软件列表？</a></h2><div class="post-meta">2015-04-19</div><span data-thread-key="/backup-apt-get/" class="ds-thread-count"></span><div class="post-content"><p><code>apt-get</code>是 ubuntu 下管理软件包的一个工具，实用简单，功能强大。平时若要安装或卸载软件包，只需轻敲一条指令即可。每一台ubuntu上，都安装着数以千百计的软件包——或是内核模块，或是工作、娱乐所需的软件，在它们的支持下，工作着这个开放的操作系统。</p>
<p>但，如果有一天，系统需要被重装——或是无可救药了，抑或是购置了新的设备，问题来了：</p>
<blockquote>
<p>如何将现有电脑上的软件包迁移至新的系统呢？</p>
</blockquote>
<p>很简单。</p>
<p>首先，将原有的软件列表导出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --get-selections  &gt; app-backup-list.lst</span><br></pre></td></tr></table></figure>
<p>最好是设置一个定时任务，每隔一段时间就保存一次列表，并且要保存到一个独立的分区。以免某天系统真的坏了。</p>
<p>接下来便是导入了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --set-selections &lt; app-backup-list.lst</span><br><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get dselect-upgrade</span><br></pre></td></tr></table></figure>
<p>至于软件源的备份，只需将<code>/etc/apt/sources.list</code>文件复制过去即可。</p>
</div></div><div class="post"><h2 class="post-title"><a href="/html5-media-test/">初试HTML5</a></h2><div class="post-meta">2015-04-19</div><span data-thread-key="/html5-media-test/" class="ds-thread-count"></span><div class="post-content"><h2 id="audio_&amp;_video">audio &amp; video</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">video</span> <span class="attribute">src</span>=<span class="value">"http://www.w3school.com.cn/i/movie.ogg"</span> <span class="attribute">controls</span>=<span class="value">"controls"</span>&gt;</span></span><br><span class="line">您的浏览器不支持 video 标签。</span><br><span class="line"><span class="tag">&lt;/<span class="title">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">audio</span> <span class="attribute">src</span>=<span class="value">"http://www.w3school.com.cn/i/horse.ogg"</span> <span class="attribute">controls</span>=<span class="value">"controls"</span>&gt;</span></span><br><span class="line">Your browser does not support the audio element.</span><br><span class="line"><span class="tag">&lt;/<span class="title">audio</span>&gt;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"center-example"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">video</span> <span class="attribute">src</span>=<span class="value">"http://www.w3school.com.cn/i/movie.ogg"</span> <span class="attribute">controls</span>=<span class="value">"controls"</span>&gt;</span></span><br><span class="line">    您的浏览器不支持 video 标签。</span><br><span class="line">    <span class="tag">&lt;/<span class="title">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">audio</span> <span class="attribute">src</span>=<span class="value">"http://www.w3school.com.cn/i/horse.ogg"</span> <span class="attribute">controls</span>=<span class="value">"controls"</span>&gt;</span></span><br><span class="line">    Your browser does not support the audio element.</span><br><span class="line">    <span class="tag">&lt;/<span class="title">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## canvas</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"myCanvas"</span>&gt;</span></span><br><span class="line">    your browser does not support the canvas tag </span><br><span class="line"><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">var</span> canvas=<span class="built_in">document</span>.getElementById(<span class="string">'myCanvas'</span>);</span><br><span class="line">    <span class="keyword">var</span> ctx=canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    ctx.fillStyle=<span class="string">'#FF0000'</span>;</span><br><span class="line">    ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">80</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">var</span> grd=ctx.createLinearGradient(<span class="number">0</span>,<span class="number">0</span>,<span class="number">175</span>,<span class="number">50</span>);</span><br><span class="line">    grd.addColorStop(<span class="number">0</span>,<span class="string">"#FF0000"</span>);</span><br><span class="line">    grd.addColorStop(<span class="number">1</span>,<span class="string">"#00FF00"</span>);</span><br><span class="line">    ctx.fillStyle=grd;</span><br><span class="line">    ctx.fillRect(<span class="number">0</span>,<span class="number">100</span>,<span class="number">175</span>,<span class="number">50</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<div class="center-example"><br>    <canvas id="myCanvas" class="align-center"><br>        your browser does not support the canvas tag<br>    </canvas><br></div>

<script type="text/javascript">
    var canvas=document.getElementById('myCanvas');
    var ctx=canvas.getContext('2d');
    ctx.fillStyle='#FF0000';
    ctx.fillRect(0,0,80,100);
    var grd=ctx.createLinearGradient(0,0,175,50);
    grd.addColorStop(0,"#FF0000");
    grd.addColorStop(1,"#00FF00");
    ctx.fillStyle=grd;
    ctx.fillRect(0,100,175,50);
</script>

<h2 id="LocalStorage">LocalStorage</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $input = $(<span class="string">"#localstorage-input"</span>), key = <span class="string">'my-key'</span>;</span><br><span class="line">$input.val(localStorage.getItem(key));</span><br><span class="line">$input.on(<span class="string">'change, keyup'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    localStorage.setItem(key, $input.val());</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><div class="example"><br>    <div class="form-group"><br>        <label class="control-label">这个文本框中的内容不会改变：</label><br>        <input id="localstorage-input" type="text" class="form-control"><br>    </div><br></div></p>
<script type="text/javascript">
    var $input = $("#localstorage-input"), key = 'my-key';
    $input.val(localStorage.getItem(key));
    $input.on('change, keyup', function () {
        localStorage.setItem(key, $input.val());
    })
</script></div></div><div class="post"><h2 class="post-title"><a href="/migrate-to-github.io/">博客迁移至Github.io</a></h2><div class="post-meta">2015-04-17</div><span data-thread-key="/migrate-to-github.io/" class="ds-thread-count"></span><div class="post-content"><p>###为什么迁出？</p>
<p>话说<strong>SinaAppEngine</strong>真是越来越不像话了：在没有征得我们开发者的同意的情况下擅自把应用总数限制调整为5个（整整少了一半！），还口口声声说是作过调查——</p>
<blockquote>
<p>“大约90%开发者只用5个应用就足够了。”</p>
</blockquote>
<p>同时，增加配额的钱还那么贵，实在担负不起的我只好精简应用数目，以防未来某天应用数不够用。</p>
<p>###为什么选择Github Pages？<br>本人爱好程序，习惯以代码的方式来做事——写文章时也不例外。因此，我需要找到一个支持Markdown的博客平台进行迁移。为此，我经历了很长时间的思想斗争——</p>
<p><strong>新浪、网易 等国内博客平台？</strong></p>
<p>果断否决。这些平台都是面向大众的，只提供富文本编辑器，效率捉急。</p>
<p><strong>博客园？“程序员的网上家园”，总会好一些吧？</strong></p>
<p>虽说最近博客园推出了Markdown编辑器，一切似乎很美好。但是——它——没有即时预览的功能！！这么重要的东西都不加上，写作时就像浑水中摸鱼一样，别提多不爽了。再说了，在博客园上聚集的多是些常工作于Windows平台下的程序员，在“信仰”方面有些合不来（别打我～～）。思考再三，还是否决了。</p>
<p>而事实上，比起公共博客平台，我还是比较喜欢个人博客。一来逼格比较高，可以为将来的交友、面试等活动加分；二来可以随心所欲地自定义样式，使网站完全符合我的Style。</p>
<p>这么一来，似乎就只剩下Github Pages了。</p>
<p>###那么，如何在Github Pages上进行写作？</p>
<p>首先要介绍一下 Github Pages 的架构。先看看 <a href="https://help.github.com/articles/using-jekyll-with-pages/#using-jekyll" target="_blank" rel="external">Github的介绍</a>：</p>
<blockquote>
<h4 id="Using_Jekyll">Using Jekyll</h4><p>Every GitHub Page is run through Jekyll when you push content to a specially named branch within your repository. For User Pages, use the master branch in your username.github.io repository. For Project Pages, use the gh-pages branch in your project’s repository. Because a normal HTML site is also a valid Jekyll site, you don’t have to do anything special to keep your standard HTML files unchanged. Jekyll has thorough documentation that covers its features and usage. Simply start committing Jekyll formatted files and you’ll be using Jekyll in no time.</p>
</blockquote>
<p>可以看得出来，Github Pages使用Jekyll作为后端引擎——这是一个用Ruby写的博客框架。但用户不需要写一行Ruby的代码，只需在名为<strong><username>.github.io</username></strong>的项目下面以一定的目录结构放置markdown文件，Jekyll便会自动生成整个站点。</p>
<p>这里需要注意的是，Jekyll生成的站点是<strong>静态的</strong>，也就是说站点的文件是Jekyll编译好之后存放在服务器端的，而不是接到请求之后才去编译站点，因此站点的访问速度是相当快的——这也是它的优点。</p>
<hr>
<p>我被这种机制深深地震惊了：这是一种我从来没见过的写作方式，无论是从方式上，抑或是从形式上。Jekyll 能让你真正专注于写作，而不是其他一些无谓的东西。     </p>
<p>它把一切无关的东西都摒弃了，这才是真正的极简主义。</p>
<hr>
<p>最初的Jekyll站点是没有样式的。为了不重复发明轮子，我决定使用现成的主题。在网上略一搜索便有了收获：<a href="http://jekyllbootstrap.com/" target="_blank" rel="external">Jekyll Bootstrap</a>。</p>
<p>Bootstrap是我最常用，也是最欣赏的一个前端框架。因此尽管这个主题仍在开发当中，我还是毫不犹豫地选中了它。    </p>
<p>从 <a href="https://github.com/plusjade/jekyll-bootstrap.git" target="_blank" rel="external">Github</a> 上将这个项目 clone 下来，覆盖到hsfzxjy.github.io项目下，理论上，站点就可以运行了。接下来，进行一些样式上的微调就可以了。   </p>
<p>至于评论系统，由于 Github Pages 是静态站点，因此只能使用第三方评论服务。Jekyll 默认的评论服务是Disqus ——一个国外的评论服务站点，但考虑到我在国内，许多人无法使用Facebook，Twitter等社交平台登录评论，我将它替换为了<strong>多说</strong>。具体操作，可以参考 <a href="http://havee.me/internet/2013-07/add-duoshuo-commemt-system-into-jekyll.html" target="_blank" rel="external">这里</a>。</p>
<p>Github Pages上的文章只能在本地编辑，因而需要一个趁手的 Markdown 编辑器。在 Ubuntu 环境下我使用的是 <strong>ReText</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install retext</span><br></pre></td></tr></table></figure></div></div><div class="post"><h2 class="post-title"><a href="/solution-of-network-broken-down-per-20s-under-ubuntu/">Ubuntu 网络每20秒断开重连一次的解决方案</a></h2><div class="post-meta">2015-03-31</div><span data-thread-key="/solution-of-network-broken-down-per-20s-under-ubuntu/" class="ds-thread-count"></span><div class="post-content"><p>从昨天到现在一直都有这个问题，刚刚突然就解决了，至今不明白原理，在此记录一下：</p>
<blockquote>
<p>在网络设置中取消<strong>需要IPv6完成这个链接</strong>的选项</p>
</blockquote>
</div></div><div class="post"><h2 class="post-title"><a href="/provement-of-Sinusoidal-AC-RMS-calculation-formula/">关于正弦交流电有效值计算公式的证明</a></h2><div class="post-meta">2015-03-04</div><span data-thread-key="/provement-of-Sinusoidal-AC-RMS-calculation-formula/" class="ds-thread-count"></span><div class="post-content"><h3 id="公式">公式</h3><p>$I = {I_m \over \sqrt{2}}$</p>
<h3 id="证明">证明</h3><p>设 $I = Asin\omega t$，则$I^2 = A^2sin^2\omega t$。</p>
<p>取半个周期进行计算：$${Q \over R} $$<br>$$= \int_0^{T \over 2} I^2tdt$$<br>$$={A^2 \over 2}(t - {sin2\omega t \over 2\omega})|_{0}^{T \over 2}$$<br>$$={A^2T \over 4}$$<br>$$={I^2T \over 2}$$</p>
<p>进而： $I = {A \over \sqrt{2}}$</p>
</div></div><div class="post"><h2 class="post-title"><a href="/HFMUN-reconstruction-3/">【HFMUN重构系列】3. 消息系统</a></h2><div class="post-meta">2015-03-03</div><span data-thread-key="/HFMUN-reconstruction-3/" class="ds-thread-count"></span><div class="post-content"><blockquote>
<p>一个真正优秀的系统，值得你无数次地去重构。</p>
</blockquote>
<p>消息系统算是网站比较重要的一部分，它承担着将<strong>已发生的事件通知给相关用户</strong>的责任。看似简单，但若想做到DRY，实现起来却很复杂——因为，通知的类型太多了。</p>
<p>这个系统，在三个项目中我实现了三次。三次都使用不同的方法，但三次都不怎么满意。这最后一次，算是比较成功的一次了。</p>
<p>在第一版模联网站中，我采用了一个堪称最糟糕的方案（如图所示）：</p>
<p><img src="/assets/wboard_notifications.jpg" alt="UML"></p>
<p>这个方案最大的缺点：</p>
<ol>
<li><strong>耦合度太高</strong>。如果有一天，又多了一种消息类型，那么就要多加一张表。</li>
<li><strong>查询的难度大</strong>。通常来说我们需要显示所有的消息，从而需要使用JOIN语句进行多表联查——这效率是很低的。</li>
<li><strong>SQL本身就不是面向对象的</strong>。虽说<code>CommentNotification</code>是<code>Notification</code>的子类，可查询时却并不能使用类似<code>Notification.objects.all()</code>一类的语句。在一定程度上可以说：SQL本身就不是面向对象的。</li>
</ol>
<p>而在第二版模联网站中，我采用了<a href="https://docs.djangoproject.com/en/1.7/ref/contrib/contenttypes/" target="_blank" rel="external">泛型</a>（Generic Model Relations）这一技术来实现——这是Django另一大特色：<strong>通过记录对象的类型信息以及唯一标识符，实现了一种可以指向任何表的外键（GenericRelation）</strong>。这种技术存在的目的就是为了<strong>解耦合</strong>，使系统扩展更具灵活性——尽管要损失一些效率，但与架构的“健康”比起来那是微不足道的，无可厚非。</p>
<p>UML图如下：</p>
<p><img src="/assets/hfmun_notices.jpg" alt="UML"></p>
<p>这其中，<code>notice_type</code>的取值决定了<strong><code>url</code>域的作用</strong>：</p>
<ul>
<li><strong><code>link</code></strong>。该消息的<code>url</code>域表示一个指向<code>related_object</code>的地址，应该展示给用户看。</li>
<li><strong><code>invoke</code></strong>。该消息需要在用户确认后执行一个动作。其<code>url</code>域表示需要执行的动作的地址——这里有些TaskQueue的意味。</li>
</ul>
<p>然而，发消息时又应该怎么做呢？如果在所有的地方都来一句：<code>Notice.create(......)</code>，那也太不DRY了吧？</p>
<p>有人说：“懒惰是程序员的天性。”</p>
<p>我赞同，但我还想补充一句：“懒惰更是程序员精简代码的动力。”</p>
<p>于是，我创立了一个类<code>NoticeDispatcher</code>，用于分发消息——其实这一类工具代码在之前的系统中也存在过，只不过这一版本的令我更为满意。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">NoticeDispatcher</span><span class="params">(object)</span>:</span>

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model, default = {})</span>:</span>
        <span class="keyword">if</span> <span class="keyword">not</span> issubclass(model, SendNoticeModelMixin):
            <span class="keyword">raise</span> TypeError(<span class="string">'The `model` must be a subclass of  `SendNoticeModelMixin`.'</span>)
        self.__model = model
        self.__default = {}
        self.__default.update(default)

    <span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, *args, **kwargs)</span>:</span>
        klass = Notice

        title = self.__model.generate_title(*args, **kwargs) 
        content = self.__model.generate_content(*args, **kwargs) 
        url = self.__model.generate_url(*args, **kwargs)
        user = self.__model.generate_user(*args, **kwargs)

        valid_keys_set = set(kwargs.iterkeys()) &amp; \
            set(field.name <span class="keyword">for</span> field <span class="keyword">in</span> klass._meta.fields)

        params = deepcopy(self.__default)
        params.update({key: kwargs[key] <span class="keyword">for</span> key <span class="keyword">in</span> valid_keys_set})
        params.update({
            <span class="string">'title'</span>: title,
            <span class="string">'content'</span>: content,
            <span class="string">'url'</span>: url,
        })

        results = []
        <span class="keyword">try</span>:
            iter(user)
        <span class="keyword">except</span>:
            user = (user,)

        <span class="keyword">for</span> _user <span class="keyword">in</span> user:
            params[<span class="string">'user'</span>] = _user
            notice = klass(*args, **params)
            notice.save()
            results.append(notice)

        <span class="keyword">return</span> results
</code></pre><p>我们可以传入一个模型类作为参数从而获得一个<code>NoticeDispatcher</code>对象。这个模型类被要求继承于<code>notices.mixins.SendNoticeModelMixin</code>，以完成一些默认的配置——这是一个抽象基类：</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">SendNoticeModelMixin</span><span class="params">(object)</span>:</span>

<span class="decorator">    @classmethod</span>
    <span class="function"><span class="keyword">def</span> <span class="title">generate_title</span><span class="params">(klass, *args, **kwargs)</span>:</span>
        <span class="keyword">return</span> <span class="string">''</span>

<span class="decorator">    @classmethod</span>
    <span class="function"><span class="keyword">def</span> <span class="title">generate_content</span><span class="params">(klass, *args, **kwargs)</span>:</span>
        <span class="keyword">return</span> <span class="string">''</span>

<span class="decorator">    @classmethod</span>
    <span class="function"><span class="keyword">def</span> <span class="title">generate_url</span><span class="params">(klass, *args, **kwargs)</span>:</span>
        <span class="keyword">return</span> <span class="string">''</span>

<span class="decorator">    @classmethod</span>
    <span class="function"><span class="keyword">def</span> <span class="title">generate_user</span><span class="params">(klass, *args, **kwargs)</span>:</span>
        <span class="keyword">return</span> []
</code></pre><p>做完这一切之后，每当调用<code>notice_dispatcher.send()</code>方法时，<code>NoticeDispatcher</code>会自动调用模型类中的<code>generate_*</code>方法以获取构建消息对象的默认参数。像一些基本不变的内容——如<code>url</code>、<code>title</code>就可以用代码自动生成，进而提高代码复用率。</p>
<p>当然，这个系统仍有一些不够完善的地方，如：</p>
<ul>
<li><code>notice_type</code>为<code>invoke</code>时的逻辑至今尚未实现。</li>
<li>当消息的构建不需要<code>related_object</code>参数时，仍需调用原生的<code>create</code>方法，非常麻烦。</li>
<li><code>related_object</code>参数仍需手动传入，有些不干净——最好就是能在<code>SendNoticeModelMixin</code>上实现<code>send</code>方法，很多啰嗦的代码便又可以省略掉了。</li>
</ul>
<p>以上问题，或是由于没有需求，或是由于懒惰（- -!），没有来得及去实现。但愿能在下一次改进时解决。</p>
<p>总而言之呢，事情正在似乎在朝着好的方面发展。</p>
</div></div><div class="post"><h2 class="post-title"><a href="/ten-years/">十年</a></h2><div class="post-meta">2015-03-03</div><span data-thread-key="/ten-years/" class="ds-thread-count"></span><div class="post-content"><p>再一次站在这里，我却发现早已没有了熟悉的感觉。一切都是那样陌生：长年累月的雨水冲刷，使原本灰色的墙面变得愈加晦暗，有几处墙皮脱落了，酷似一张布满皱纹的老脸；门前，野草肆意地疯长着，没过了缩在墙角的那根水管——记忆中它一直在渗水，却不知何时被修好了，只留下了一圈丑陋的青苔，像是对这十年光阴的一个标注。</p>
<p>这里的一切，就像是被人遗弃了。四周站着的那一圈高楼，无时无刻不在表达着对这角隅的不屑——就像长辈们对待无知的孩童一样。<br>而事实上，这里比周围的一切都要年长。</p>
<p>时光上溯十年，那时，我居住于此。那时，还没有周围这一切。</p>
<p>曾记得，在不远处的那块菜地，我和小伙伴趟过泥水，猫着腰在捕捉小鱼小虾。柔软的泥土记录这我们的足迹，竹架上的蔬果聆听着我们的欢笑，就连那不知名的虫儿，也哼起歌为我们助兴。</p>
<p>曾记得，在屋后的那片小树林，上演过一次又一次的“探险之旅”。不畏阴暗，不惧神秘，只求抵达尽头时那种大汗淋漓的快意。</p>
<p>曾记得，在楼顶的天台，我第一次仰望星空。夏夜的风吹起架子上的藤蔓，吹拂着我的脸庞。和着如水的月光，四周的一切就像仙境般梦幻。</p>
<p>这里，有着我童年的所有回忆。</p>
<p>可如今，这一切都像是未曾发生过。这里，也未曾记得。</p>
<p>十年，很长，长得足以让一个人，去遗忘一个地方。</p>
<p>再一次遇见他，没有太多的喜悦，只是相视一笑，随即，便陷入了沉默。</p>
<p>比起上一次相遇，他又有了一些变化，整个人显得更加成熟了。但与此同时，一种未知的像雾一样的却在我们中间弥散开来，凝固着空气，窒息着心灵。</p>
<p>我竭力搜寻着话题，想要打破这恼人的尴尬，但却徒劳无功——真的没有共同语言了，毕竟在新的环境里，我们都有了新的爱好。</p>
<p>真是一个让人迷惑的时代——在这里，共有着美好的回忆，却也无法维系十年的友情。</p>
<p>在那人生的上古时期，他，是我最好的朋友，一起逃过课，在小学边上的山坡尽情地疯玩；一起偷过钱，忐忑地在小商店购买垂涎已久的零食。那些年和他，一玩能玩一天，一聊能聊一宿。我们有过争吵，而更多时候，我们亲如弟兄。</p>
<p>记忆中的那些画面，每一张笑脸，每一滴眼泪，都是那样真诚。</p>
<p>只是，曾经的旧知己，最终还是变不到老友。</p>
<p>十年，很长，长得足以让一个人，去疏远另一个人。</p>
<p>十年，真的很长。承载着过去的回忆，有欢笑，有泪水——就像是人那短暂一生的缩影。</p>
<p>人生又能有几个十年？无从得知。</p>
<p>因此，每一个十年都弥足珍贵；每一个十年，都要用心去珍惜。</p>
</div></div><div class="post"><h2 class="post-title"><a href="/kill-processes-under-ubuntu/">ubuntu杀死进程</a></h2><div class="post-meta">2015-03-02</div><span data-thread-key="/kill-processes-under-ubuntu/" class="ds-thread-count"></span><div class="post-content"><pre><code>ps <span class="operator">-e</span> <span class="comment">#查看进程列表</span>
sudo <span class="built_in">kill</span> &lt;pid&gt;
</code></pre></div></div><div class="page-navigator"><a href="/" class="pre">上一页</a><a href="/page/3/" class="next">下一页</a></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://hsfzxjy.github.io"></form></div></div><div class="widget"><div class="widget-title">导航<ul><li><a href="/archives/"> <i class="icon-archives"> 归档</i></a></li><li><a href="/works/"> <i class="icon-works"> 个人作品</i></a></li><li><a href="/atom.xml"> <i class="icon-rss"> 订阅</i></a></li></ul></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学/">数学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂感/">杂感</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载文章/">转载文章</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随手记/">随手记</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/apt-get/" style="font-size: 15px;">apt-get</a> <a href="/tags/Delphi/" style="font-size: 15px;">Delphi</a> <a href="/tags/杂感/" style="font-size: 15px;">杂感</a> <a href="/tags/诗/" style="font-size: 15px;">诗</a> <a href="/tags/作文/" style="font-size: 15px;">作文</a> <a href="/tags/家书/" style="font-size: 15px;">家书</a> <a href="/tags/成人礼/" style="font-size: 15px;">成人礼</a> <a href="/tags/产品/" style="font-size: 15px;">产品</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/web设计/" style="font-size: 15px;">web设计</a> <a href="/tags/wisecity/" style="font-size: 15px;">wisecity</a> <a href="/tags/前端自动化测试，总结/" style="font-size: 15px;">前端自动化测试，总结</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/单元测试/" style="font-size: 15px;">单元测试</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/不经意间的感动/" style="font-size: 15px;">不经意间的感动</a> <a href="/tags/HFMUN重构系列/" style="font-size: 15px;">HFMUN重构系列</a> <a href="/tags/化学/" style="font-size: 15px;">化学</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/物理/" style="font-size: 15px;">物理</a> <a href="/tags/创新作文大赛/" style="font-size: 15px;">创新作文大赛</a> <a href="/tags/Sublime/" style="font-size: 15px;">Sublime</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/字体/" style="font-size: 15px;">字体</a> <a href="/tags/百题大过关/" style="font-size: 15px;">百题大过关</a> <a href="/tags/逆袭/" style="font-size: 15px;">逆袭</a> <a href="/tags/MySql/" style="font-size: 15px;">MySql</a> <a href="/tags/NOIP2014/" style="font-size: 15px;">NOIP2014</a> <a href="/tags/信息学竞赛/" style="font-size: 15px;">信息学竞赛</a> <a href="/tags/北大金秋营/" style="font-size: 15px;">北大金秋营</a> <a href="/tags/树状数组/" style="font-size: 15px;">树状数组</a> <a href="/tags/LCA/" style="font-size: 15px;">LCA</a> <a href="/tags/归并排序/" style="font-size: 15px;">归并排序</a> <a href="/tags/逆序对/" style="font-size: 15px;">逆序对</a> <a href="/tags/最小生成树/" style="font-size: 15px;">最小生成树</a> <a href="/tags/数论/" style="font-size: 15px;">数论</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/数列/" style="font-size: 15px;">数列</a> <a href="/tags/高精度/" style="font-size: 15px;">高精度</a> <a href="/tags/UVa/" style="font-size: 15px;">UVa</a> <a href="/tags/Pascal/" style="font-size: 15px;">Pascal</a> <a href="/tags/搜索/" style="font-size: 15px;">搜索</a> <a href="/tags/剪枝/" style="font-size: 15px;">剪枝</a> <a href="/tags/浮点数/" style="font-size: 15px;">浮点数</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/游记/" style="font-size: 15px;">游记</a> <a href="/tags/win32/" style="font-size: 15px;">win32</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/poems/">诗集</a></li><li class="post-list-item"><a class="post-list-link" href="/life-needs-discovery/">生活，需要被“发现”</a></li><li class="post-list-item"><a class="post-list-link" href="/letter-to-parents/">家书·十八岁成人礼</a></li><li class="post-list-item"><a class="post-list-link" href="/hobby-or-needs/">炫技？还是需求？</a></li><li class="post-list-item"><a class="post-list-link" href="/the-state-of-responsive-images-in-2015/">【译】响应式图片的现状</a></li><li class="post-list-item"><a class="post-list-link" href="/why-are-so-many-programming-languages/">【译】“为什么有这么多的编程语言？”</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-fuck-a-bilk-site/">记一次 DoS 诈骗网站的经历</a></li><li class="post-list-item"><a class="post-list-link" href="/wisecity-conclusion/">Wisecity 商赛总结——也谈前端自动化测试</a></li><li class="post-list-item"><a class="post-list-link" href="/secret/">不能说的秘密</a></li><li class="post-list-item"><a class="post-list-link" href="/that-starry-night/">那一年，我们望向星空</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">thoughts of hsfzxjy.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></body><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>$(document).ready(function() {
  $('img').each(function() {
    if ($(this).parent().hasClass('fancybox')) return;
    if ($(this).hasClass('nofancybox')) return;
    var alt = this.alt;
    if (alt) $(this).after('<span class="caption">' + alt + '</span>');
    $(this).wrap('<a href="' + ($(this).attr('data-src') == null ? this.src : $(this).attr('data-src')) + '" title="' + alt + '" class="fancybox"></a>');
  });
  $(this).find('.fancybox').each(function(){
    $(this).attr('rel', 'article');
  });
});</script><script>$(document).ready(function() {
  $("a[href$='.jpg'],a[href$='.png'],a[href$='.gif']").attr('rel', 'gallery').fancybox({
   helpers : {
   title: { type: 'inside'}
   }
 });
});
</script><script>var duoshuoQuery = {short_name:'hsfzxjy'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$']]},
  jax: ["input/TeX","output/HTML-CSS"]
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></html>