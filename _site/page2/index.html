
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>主页</title>
    
    <script src="/assets/themes/bootstrap-3/bootstrap/js/jquery.min.js"></script>
    <meta name="author" content="Jinyi Xie">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/bootstrap-3/pygments.css">
    
    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default navbar-inverse" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">hsfzxjy</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archieve.html">归档</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
  
    
      
      	
      	<li><a href="/pages.html">页面</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about/">联系我</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  



          </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container" id="main-container">
        
<div class="page-header">
  <h1 class="post-title">
         
         <small class="tagline">What I expect, is that lonely starry night.</small>
  </h1>
</div>

<div class="row">
  <div class="col-xs-12 post-content">
    
<link rel="stylesheet" type="text/css" href="/assets/themes//bootstrap-3/css/index.css?body=1">
<div class="posts">
  
    <article class="post-content">
        <header class="text-center">
            <h1 class="post-title">
                <a href="/backup-apt-get/">如何备份apt-get已安装的软件列表？</a>
            </h1>
            <p class="time">19 Apr 2015</p>
        </header>
        <section class="content">
            <p><code>apt-get</code>是 ubuntu 下管理软件包的一个工具，实用简单，功能强大。平时若要安装或卸载软件包，只需轻敲一条指令即可。每一台ubuntu上，都安装着数以千百计的软件包——或是内核模块，或是工作、娱乐所需的软件，在它们的支持下，工作着这个开放的操作系统。</p>

<p>但，如果有一天，系统需要被重装——或是无可救药了，抑或是购置了新的设备，问题来了：</p>

<blockquote>
<p>如何将现有电脑上的软件包迁移至新的系统呢？</p>
</blockquote>

<p>很简单。</p>

<p>首先，将原有的软件列表导出：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo dpkg --get-selections  &gt; app-backup-list.lst
</code></pre></div>
<p>最好是设置一个定时任务，每隔一段时间就保存一次列表，并且要保存到一个独立的分区。以免某天系统真的坏了。</p>

<p>接下来便是导入了：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo dpkg --set-selections &lt; app-backup-list.lst
sudo apt-get -y update
sudo apt-get dselect-upgrade
</code></pre></div>
<p>至于软件源的备份，只需将<code>/etc/apt/sources.list</code>文件复制过去即可。</p>

        </section>
        
          <ul class="tag_box inline">
            <li><i class="glyphicon glyphicon-open"></i></li>
            
            


  
     
    	<li><a href="/categories.html#ubuntu-ref">
    		ubuntu <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#apt-get-ref">
    		apt-get <span>1</span>
    	</a></li>
    
  


          </ul>
          

        
          <ul class="tag_box inline">
            <li><i class="glyphicon glyphicon-tags"></i></li>
            
            


  
     
    	<li><a href="/tags.html#ubuntu-ref">ubuntu <span>3</span></a></li>
     
    	<li><a href="/tags.html#apt-get-ref">apt-get <span>1</span></a></li>
    
  



          </ul>
         
    </article>
  
    <article class="post-content">
        <header class="text-center">
            <h1 class="post-title">
                <a href="/migrate-to-github/">博客迁移至Github.io</a>
            </h1>
            <p class="time">17 Apr 2015</p>
        </header>
        <section class="content">
            <h3>为什么迁出？</h3>

<p>话说<strong>SinaAppEngine</strong>真是越来越不像话了：在没有征得我们开发者的同意的情况下擅自把应用总数限制调整为5个（整整少了一半！），还口口声声说是作过调查——</p>

<blockquote>
<p>“大约90%开发者只用5个应用就足够了。”</p>
</blockquote>

<p>同时，增加配额的钱还那么贵，实在担负不起的我只好精简应用数目，以防未来某天应用数不够用。</p>

<h3>为什么选择Github Pages？</h3>

<p>本人爱好程序，习惯以代码的方式来做事——写文章时也不例外。因此，我需要找到一个支持Markdown的博客平台进行迁移。为此，我经历了很长时间的思想斗争——</p>

<p><strong>新浪、网易 等国内博客平台？</strong></p>

<p>果断否决。这些平台都是面向大众的，只提供富文本编辑器，效率捉急。</p>

<p><strong>博客园？“程序员的网上家园”，总会好一些吧？</strong></p>

<p>虽说最近博客园推出了Markdown编辑器，一切似乎很美好。但是——它——没有即时预览的功能！！这么重要的东西都不加上，写作时就像浑水中摸鱼一样，别提多不爽了。再说了，在博客园上聚集的多是些常工作于Windows平台下的程序员，在“信仰”方面有些合不来（别打我～～）。思考再三，还是否决了。</p>

<p>而事实上，比起公共博客平台，我还是比较喜欢个人博客。一来逼格比较高，可以为将来的交友、面试等活动加分；二来可以随心所欲地自定义样式，使网站完全符合我的Style。</p>

<p>这么一来，似乎就只剩下Github Pages了。</p>

<h3>那么，如何在Github Pages上进行写作？</h3>

<p>首先要介绍一下 Github Pages 的架构。先看看 <a href="https://help.github.com/articles/using-jekyll-with-pages/#using-jekyll">Github的介绍</a>：</p>

<blockquote>
<h4>Using Jekyll</h4>

<p>Every GitHub Page is run through Jekyll when you push content to a specially named branch within your repository. For User Pages, use the master branch in your username.github.io repository. For Project Pages, use the gh-pages branch in your project&#39;s repository. Because a normal HTML site is also a valid Jekyll site, you don&#39;t have to do anything special to keep your standard HTML files unchanged. Jekyll has thorough documentation that covers its features and usage. Simply start committing Jekyll formatted files and you&#39;ll be using Jekyll in no time.</p>
</blockquote>

<p>可以看得出来，Github Pages使用Jekyll作为后端引擎——这是一个用Ruby写的博客框架。但用户不需要写一行Ruby的代码，只需在名为<strong><username>.github.io</strong>的项目下面以一定的目录结构放置markdown文件，Jekyll便会自动生成整个站点。</p>

<p>这里需要注意的是，Jekyll生成的站点是<strong>静态的</strong>，也就是说站点的文件是Jekyll编译好之后存放在服务器端的，而不是接到请求之后才去编译站点，因此站点的访问速度是相当快的——这也是它的优点。</p>

<hr>

<p>我被这种机制深深地震惊了：这是一种我从来没见过的写作方式，无论是从方式上，抑或是从形式上。Jekyll 能让你真正专注于写作，而不是其他一些无谓的东西。     </p>

<p>它把一切无关的东西都摒弃了，这才是真正的极简主义。</p>

<hr>

<p>最初的Jekyll站点是没有样式的。为了不重复发明轮子，我决定使用现成的主题。在网上略一搜索便有了收获：<a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a>。</p>

<p>Bootstrap是我最常用，也是最欣赏的一个前端框架。因此尽管这个主题仍在开发当中，我还是毫不犹豫地选中了它。    </p>

<p>从 <a href="https://github.com/plusjade/jekyll-bootstrap.git">Github</a> 上将这个项目 clone 下来，覆盖到hsfzxjy.github.io项目下，理论上，站点就可以运行了。接下来，进行一些样式上的微调就可以了。   </p>

<p>至于评论系统，由于 Github Pages 是静态站点，因此只能使用第三方评论服务。Jekyll 默认的评论服务是Disqus ——一个国外的评论服务站点，但考虑到我在国内，许多人无法使用Facebook，Twitter等社交平台登录评论，我将它替换为了<strong>多说</strong>。具体操作，可以参考 <a href="http://havee.me/internet/2013-07/add-duoshuo-commemt-system-into-jekyll.html">这里</a>。</p>

<p>Github Pages上的文章只能在本地编辑，因而需要一个趁手的 Markdown 编辑器。在 Ubuntu 环境下我使用的是 <strong>ReText</strong>：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install retext 
</code></pre></div>
        </section>
          

         
    </article>
  
    <article class="post-content">
        <header class="text-center">
            <h1 class="post-title">
                <a href="/solution-of-network-broken-down-per-20s-under-ubuntu/">Ubuntu 网络每20秒断开重连一次的解决方案</a>
            </h1>
            <p class="time">31 Mar 2015</p>
        </header>
        <section class="content">
            <p>从昨天到现在一直都有这个问题，刚刚突然就解决了，至今不明白原理，在此记录一下：</p>
<blockquote>
<p>在网络设置中取消<strong>需要IPv6完成这个链接</strong>的选项</p>
</blockquote>

        </section>
        
          <ul class="tag_box inline">
            <li><i class="glyphicon glyphicon-open"></i></li>
            
            


  
     
    	<li><a href="/categories.html#ubuntu-ref">
    		ubuntu <span>9</span>
    	</a></li>
    
  


          </ul>
          

         
    </article>
  
    <article class="post-content">
        <header class="text-center">
            <h1 class="post-title">
                <a href="/provement-of-Sinusoidal-AC-RMS-calculation-formula/">关于正弦交流电有效值计算公式的证明</a>
            </h1>
            <p class="time">04 Mar 2015</p>
        </header>
        <section class="content">
            <h3>公式</h3>
<p>$I = {I_m \over \sqrt{2}}$</p>
<h3>证明</h3>
<p>设 $I = Asin\omega t$，则$I^2 = A^2sin^2\omega t$。</p>
<p>取半个周期进行计算：$${Q \over R} $$<br />
$$= \int_0^{T \over 2} I^2tdt$$<br />
$$={A^2 \over 2}(t - {sin2\omega t \over 2\omega})|_{0}^{T \over 2}$$<br />
$$={A^2T \over 4}$$<br />
$$={I^2T \over 2}$$</p>
<p>进而： $I = {A \over \sqrt{2}}$</p>

        </section>
        
          <ul class="tag_box inline">
            <li><i class="glyphicon glyphicon-open"></i></li>
            
            


  
     
    	<li><a href="/categories.html#数学-ref">
    		数学 <span>6</span>
    	</a></li>
     
    	<li><a href="/categories.html#物理-ref">
    		物理 <span>1</span>
    	</a></li>
    
  


          </ul>
          

         
    </article>
  
    <article class="post-content">
        <header class="text-center">
            <h1 class="post-title">
                <a href="/HFMUN-reconstruction-3/">【HFMUN重构系列】3. 消息系统</a>
            </h1>
            <p class="time">03 Mar 2015</p>
        </header>
        <section class="content">
            <blockquote>
<p>一个真正优秀的系统，值得你无数次地去重构。</p>
</blockquote>
<p>消息系统算是网站比较重要的一部分，它承担着将<strong>已发生的事件通知给相关用户</strong>的责任。看似简单，但若想做到DRY，实现起来却很复杂——因为，通知的类型太多了。</p>
<p>这个系统，在三个项目中我实现了三次。三次都使用不同的方法，但三次都不怎么满意。这最后一次，算是比较成功的一次了。</p>
<p>在第一版模联网站中，我采用了一个堪称最糟糕的方案（如图所示）：</p>
<p><img src="/assets/wboard_notifications.jpg" alt="UML" /></p>
<p>这个方案最大的缺点：</p>
<ol>
<li><strong>耦合度太高</strong>。如果有一天，又多了一种消息类型，那么就要多加一张表。</li>
<li><strong>查询的难度大</strong>。通常来说我们需要显示所有的消息，从而需要使用JOIN语句进行多表联查——这效率是很低的。</li>
<li><strong>SQL本身就不是面向对象的</strong>。虽说<code>CommentNotification</code>是<code>Notification</code>的子类，可查询时却并不能使用类似<code>Notification.objects.all()</code>一类的语句。在一定程度上可以说：SQL本身就不是面向对象的。</li>
</ol>
<p>而在第二版模联网站中，我采用了<a href="https://docs.djangoproject.com/en/1.7/ref/contrib/contenttypes/">泛型</a>（Generic Model Relations）这一技术来实现——这是Django另一大特色：<strong>通过记录对象的类型信息以及唯一标识符，实现了一种可以指向任何表的外键（GenericRelation）</strong>。这种技术存在的目的就是为了<strong>解耦合</strong>，使系统扩展更具灵活性——尽管要损失一些效率，但与架构的“健康”比起来那是微不足道的，无可厚非。</p>
<p>UML图如下：</p>
<p><img src="/assets/hfmun_notices.jpg" alt="UML" /></p>
<p>这其中，<code>notice_type</code>的取值决定了<strong><code>url</code>域的作用</strong>：</p>
<ul>
<li><strong><code>link</code></strong>。该消息的<code>url</code>域表示一个指向<code>related_object</code>的地址，应该展示给用户看。</li>
<li><strong><code>invoke</code></strong>。该消息需要在用户确认后执行一个动作。其<code>url</code>域表示需要执行的动作的地址——这里有些TaskQueue的意味。</li>
</ul>
<p>然而，发消息时又应该怎么做呢？如果在所有的地方都来一句：<code>Notice.create(......)</code>，那也太不DRY了吧？</p>
<p>有人说：“懒惰是程序员的天性。”</p>
<p>我赞同，但我还想补充一句：“懒惰更是程序员精简代码的动力。”</p>
<p>于是，我创立了一个类<code>NoticeDispatcher</code>，用于分发消息——其实这一类工具代码在之前的系统中也存在过，只不过这一版本的令我更为满意。</p>
<pre><code>class NoticeDispatcher(object):

    def __init__(self, model, default = {}):
        if not issubclass(model, SendNoticeModelMixin):
            raise TypeError('The `model` must be a subclass of  `SendNoticeModelMixin`.')
        self.__model = model
        self.__default = {}
        self.__default.update(default)

    def send(self, *args, **kwargs):
        klass = Notice

        title = self.__model.generate_title(*args, **kwargs) 
        content = self.__model.generate_content(*args, **kwargs) 
        url = self.__model.generate_url(*args, **kwargs)
        user = self.__model.generate_user(*args, **kwargs)

        valid_keys_set = set(kwargs.iterkeys()) &amp; \
            set(field.name for field in klass._meta.fields)

        params = deepcopy(self.__default)
        params.update({key: kwargs[key] for key in valid_keys_set})
        params.update({
            'title': title,
            'content': content,
            'url': url,
        })

        results = []
        try:
            iter(user)
        except:
            user = (user,)

        for _user in user:
            params['user'] = _user
            notice = klass(*args, **params)
            notice.save()
            results.append(notice)

        return results
</code></pre>
<p>我们可以传入一个模型类作为参数从而获得一个<code>NoticeDispatcher</code>对象。这个模型类被要求继承于<code>notices.mixins.SendNoticeModelMixin</code>，以完成一些默认的配置——这是一个抽象基类：</p>
<pre><code>class SendNoticeModelMixin(object):

    @classmethod
    def generate_title(klass, *args, **kwargs):
        return ''

    @classmethod
    def generate_content(klass, *args, **kwargs):
        return ''

    @classmethod
    def generate_url(klass, *args, **kwargs):
        return ''

    @classmethod
    def generate_user(klass, *args, **kwargs):
        return []
</code></pre>
<p>做完这一切之后，每当调用<code>notice_dispatcher.send()</code>方法时，<code>NoticeDispatcher</code>会自动调用模型类中的<code>generate_*</code>方法以获取构建消息对象的默认参数。像一些基本不变的内容——如<code>url</code>、<code>title</code>就可以用代码自动生成，进而提高代码复用率。</p>
<p>当然，这个系统仍有一些不够完善的地方，如：</p>
<ul>
<li><code>notice_type</code>为<code>invoke</code>时的逻辑至今尚未实现。</li>
<li>当消息的构建不需要<code>related_object</code>参数时，仍需调用原生的<code>create</code>方法，非常麻烦。</li>
<li><code>related_object</code>参数仍需手动传入，有些不干净——最好就是能在<code>SendNoticeModelMixin</code>上实现<code>send</code>方法，很多啰嗦的代码便又可以省略掉了。</li>
</ul>
<p>以上问题，或是由于没有需求，或是由于懒惰（- -!），没有来得及去实现。但愿能在下一次改进时解决。</p>
<p>总而言之呢，事情正在似乎在朝着好的方面发展。</p>

        </section>
        
          <ul class="tag_box inline">
            <li><i class="glyphicon glyphicon-open"></i></li>
            
            


  
     
    	<li><a href="/categories.html#hfmun重构系列-ref">
    		hfmun重构系列 <span>5</span>
    	</a></li>
     
    	<li><a href="/categories.html#编程-ref">
    		编程 <span>32</span>
    	</a></li>
    
  


          </ul>
          

         
    </article>
  
</div>

<ul class="pager">
  
    <li class="previous">
      <a class="prev" href="/page3/">&larr; Previous</a>
    </li>
  
  
  <li class="next">
    <a class="next" href="/index.html">Next &rarr;</a>
  </li>
  
</ul>

  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p class="text-center">
          Powered by Jekyll. Hosted at Github. <br>
          Copyright &copy; hsfzxjy.
        </p>
      </div>
    </div>

    <script type="text/javascript">
    var duoshuoQuery = {short_name:"hsfzxjy"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    


    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default" defer async="true"></script>
  </body>
</html>

